---
title: "Introduction to {targets}"
author: "Joel Nitta"
institute: "University of Tokyo"
date: "2022-01-12"
output:
  xaringan::moon_reader:
    lib_dir: libs
    css: xaringan-themer.css
    seal: false
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(targets)
library(tarchetypes)
library(xaringanthemer)
```

## Introduction to {targets} for effective workflows in R

**Joel Nitta**

AsiaR Meetup <span style = 'font-size: 120%;'>2022/05/07</span>

<br><br><img src="https://docs.ropensci.org/targets/logo.svg" alt="drawing" height="350" style="float:right;margin:-200px 0px">

<br><br>https://joelnitta.github.io/asiaR-targets-intro

---

## Self-introduction

.pull-left[
@joel_nitta

https://joelnitta.com

- Project Research Associate @ [Tokyo University](http://iwasakilab.k.u-tokyo.ac.jp/)

- Research interests: Ecology and evolution of __ferns__

- Hobbies: Running (after my 6YO!)
]

.pull-right[
<img src="https://github.com/joelnitta/joelnitta-site/blob/master/static/media/headers/research_img2.jpg?raw=true" alt="drawing" height="400"/>
]

---
## Outline of today's talk

- Introduction to {targets}

- Live coding

---
## Workflows in R

![Hadley Wickham's data analysis workflow chart](images/workflow_1.png)

.footnote[R for Data Science https://r4ds.had.co.nz/]

---
## Workflows in R

![Hadley Wickham's data analysis workflow chart with icon showing part of it changed](images/workflow_2.png)

If **one part** of a workflow changes, **how does it affect other parts?**

**How much of it do we need to re-run?**

---
## Reproducibility

### Is your workflow reproducible...

- ...right now?

- ...in a few months (years)?

- ...by somebody else?

<img src="https://1.bp.blogspot.com/-iG3QVEWl4dE/Wn1Vwtu1PwI/AAAAAAABKE8/8KR9vfXirfU5yXepByewkYZcrWqT-2EtQCLcBGAs/s800/computer_man3_cry.png" alt="drawing" height="250" style="float:right;margin:-100px 0px">

---
## Leave workflow management to software

Many solutions exist:

- `make` (bash)
- `snakemake` (python)
- `nextflow` (bioinformatics piplelines)
- `cwl`

etc...

<img src="https://1.bp.blogspot.com/-JbBUDpFhZDM/Wn1VzKJupgI/AAAAAAABKFU/b2iI_-WbyWM_8Bjc0aZ2JgToTD-Tu25kQCLcBGAs/s800/computer_woman4_laugh.png" alt="drawing" height="250" style="float:right;margin:-150px 0px">


---

## What is {targets}?

.pull-left[
- Workflow manager **for R**

- Only runs necessary steps

- Can run workflow steps in parallel (speeds up analysis)

- Provides proof that **results** are derived **from code**
]

<img src="https://docs.ropensci.org/targets/logo.svg" alt="drawing" height="350" style="float:right">

---
## Resources

- Github https://github.com/ropensci/targets

- Package website https://docs.ropensci.org/targets/

- User manual https://books.ropensci.org/targets/

- Targetopia https://wlandau.github.io/targetopia/

- {tarchetypes} website https://docs.ropensci.org/tarchetypes/

- Discussion board https://github.com/ropensci/targets/discussions

---
## Live Coding

- `tar_script()`: Write a generic workflow script

- `tar_visnetwork()`: Visualize the state of the workflow

- `tar_make()`: Run the workflow

- `tar_load()`: Load a target from the workflow

- `tar_outdated()`ï¼š List which steps will be run next time

---
class: inverse, center, middle

# Live Coding

---
## Example workflows

### gapminder workflow

https://github.com/joelnitta/targets_gapminder_example

### variant calling workflow

https://github.com/joelnitta/targets_vcf_example

---
## Summary

- Write your workflow plan in `_targets.R`

- Run your workflow with `tar_make()`

- Check the status of your workflow with `tar_visnetwork()`

---
## If you want to learn more...

User manual https://books.ropensci.org/targets/

<img src="https://4.bp.blogspot.com/--ZNd-68qDog/Vq8822mkoUI/AAAAAAAA3gM/-NwzZtON8Dk/s800/setsumeisyo_woman.png" alt="drawing" height="250" style="float:right;margin:0px 0px">

---
class: inverse, center, middle

# Thank you!
